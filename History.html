<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      body {
        background-color: black;
        color: black;
        font-size: 14pt;
      }
    </style>
    <script type="text/javascript">
      //
      var addShadow = "0px 0px 10px #BABBFD";
      var removeShadow = "0px 0px 0px";
      var backgroundColor = "#F0F0F0";
      var bgCList = "#BABBFD";
      var meatballHistoryItemContainerWidth = "calc(500px - 2.25rem)";
      var regex = /[^\d\w\s\.\?\!\@]/g;
      (function () {
        window.addEventListener("load", function () {
          test();
        });
        var testList = [
          "hi mark!",
          "hi mark?",
          "hi mark.",
          "hi mark",
          "hi mark",
        ];
        var authorList = ["Joshua", "Pierre", "Joshua", "Pierre", "Pierre"];
        var history = new MeatballHistory();
        var add = true;

        function test() {
          var entryPoint = document.getElementById("entry");
          entryPoint.innerText = "Script Works";
          entryPoint.style.cursor = "pointer";
          entryPoint.style.backgroundColor = "#999999";
          entryPoint.style.borderRadius = ".25rem";
          entryPoint.style.padding = ".25rem";
          entryPoint.style.width = "120px";
          entryPoint.style.textAlign = "center";

          entryPoint.addEventListener("click", function () {
            if (add) {
              add = !add;
              testList.forEach(function (item, i) {
                history.push(
                  new MeatballHistoryItem().setDisplay(
                    authorList[i],
                    new Date().getTime(),
                    item
                  )
                );
              });
            }
            document.body.appendChild(history.historyPanel);
          });

          entryPoint.addEventListener("mouseleave", function (e) {
            if (e) {
              if (e.toElement) {
                if (e.toElement.parentNode) {
                  if (!e.toElement.parentNode.contains(history.historyPanel)) {
                    if (history) {
                      if (history.historyPanel) {
                        if (history.historyPanel.parentNode) {
                          history.historyPanel.parentNode.removeChild(
                            history.historyPanel
                          );
                        }
                      }
                    }
                  }
                }
              }
            }
          });
        }

        function MeatballHistory() {
          var meatballHistory = this;
          var windowHeight = window.innerHeight || document.body.clientHeight;
          this.historyPanel = document.createElement("div");
          this.historyPanel.style.padding = ".25rem";
          this.historyPanel.style.width = "calc(500px - .5rem)";
          this.historyPanel.style.height = windowHeight + "px";
          this.historyPanel.style.backgroundColor = backgroundColor;
          this.historyPanel.style.textAlign = "center";
          this.historyPanel.style.position = "fixed";
          this.historyPanel.style.top = "0px";
          this.historyPanel.style.right = "0px";

          this.title = document.createElement("div");
          this.title.style.width = "calc(500px - .5rem)";
          this.title.style.textAlign = "center";
          this.title.style.marginRight = "auto";
          this.title.style.marginLeft = "auto";
          this.title.style.marginBottom = ".5rem";
          this.title.style.display = "flex";
          this.title.style.flexDirection = "row";

          this.comment = document.createElement("div");
          this.comment.innerText = "History";
          this.comment.style.flexGrow = "1";
          this.comment.style.flexShrink = "1";
          this.comment.style.paddingLeft = ".5rem";
          this.comment.style.textAlign = "left";
          this.title.appendChild(this.comment);

          this.svgContainer = document.createElement("div");
          this.svgContainer.style.flexGrow = "4";
          this.svgContainer.style.flexShrink = "1";
          this.svgContainer.style.textAlign = "right";
          this.svgContainer.style.marginRight = ".75rem";

          this.svg = new SVGGenerator({
            color: "green",
            type: "add",
            size: "normal",
          }).wrapper;
          this.svg.style.cursor = "pointer";

          this.svg.addEventListener("click", function () {
            if (meatballHistory.container.addNew) {
              meatballHistory.container.scroll(0, 0);
              meatballHistory.container.addNew = false;
              meatballHistory.newItem();
            }
          });

          this.svgContainer.appendChild(this.svg);

          this.title.appendChild(this.svgContainer);

          this.historyPanel.appendChild(this.title);

          this.container = document.createElement("div");
          this.container.style.width = "calc(500px - 2.25rem)";
          this.container.style.height = windowHeight - 100 + "px";
          this.container.style.margin = "auto";
          this.container.style.paddingTop = ".25rem";
          this.container.style.paddingLeft = ".25rem";
          this.container.style.paddingRight = "2rem";
          this.container.style.overflowX = "hidden";
          this.container.style.overflowY = "auto";
          this.container.addNew = true;
          this.container.isEdit = true;
          this.historyPanel.appendChild(this.container);

          this.addMore = document.createElement("div");
          this.addMore.innerText = "Show More";
          this.addMore.style.cursor = "pointer";
          this.addMore.style.marginTop = ".25rem";
          this.addMore.style.marginLeft = "auto";
          this.addMore.style.marginRight = "auto";
          this.addMore.style.padding = ".25rem";
          this.addMore.style.borderRadius = ".25rem";
          this.addMore.style.width = "115px";
          this.addMore.style.backgroundColor = "#999999";

          this.historyPanel.appendChild(this.addMore);

          this.addMore.addEventListener("click", function () {
            testList.forEach(function (item, i) {
              history.push(
                new MeatballHistoryItem().setDisplay(
                  authorList[i],
                  new Date().getTime(),
                  item
                )
              );
            });
          });
          this.historyPanel.addEventListener("mouseleave", function () {
            var panel = this;
            if (panel) {
              if (panel.parentNode) {
                panel.parentNode.removeChild(panel);
              }
            }
          });
          return this;
        }

        MeatballHistory.prototype.newItem = function () {
          var item = new MeatballHistoryItem()
            .setDisplay("Joshua", new Date().getTime(), "")
            .setEditable(true);
          item.isNew = true;
          item.setType("Joshua", "user");
          this.container.insertBefore(item.item, this.container.firstChild);
          return this;
        };

        MeatballHistory.prototype.push = function (change) {
          change.setType("Joshua", "user");
          this.container.appendChild(change.item);
          return this;
        };

        MeatballHistory.prototype.clear = function () {
          while (this.container.firstChild) {
            this.container.removeChild(this.container.firstChild);
          }
        };

        function MeatballHistoryItem() {
          var meatballHistoryItem = this;
          this.item = document.createElement("div");
          this.item.style.padding = ".25rem";
          this.item.style.width = meatballHistoryItemContainerWidth;
          this.item.style.margin = "0px;";
          this.item.style.marginBottom = ".25rem";
          this.item.style.padding = ".25rem";
          this.item.type = "auto";

          this.display = document.createElement("div");
          this.display.style.display = "block";
          this.display.style.width = meatballHistoryItemContainerWidth;
          this.display.style.padding = "0px";
          this.display.style.marginRight = "0px";
          this.display.style.marginLeft = "0px";

          this.author = document.createElement("div");
          this.author.contentEditable = false;
          this.author.style.width = meatballHistoryItemContainerWidth;
          this.author.style.padding = ".25rem";
          this.author.style.margin = "0px";
          this.author.style.verticalAlign = "middle";
          this.author.style.textAlign = "left";
          this.author.style.fontSize = "10pt";
          this.display.appendChild(this.author);

          this.item.addEventListener("mouseenter", function () {
            this.style.boxShadow = addShadow;
          });
          this.item.addEventListener("mouseleave", function () {
            this.style.boxShadow = removeShadow;
          });

          this.isNew = false;

          this.submit = document.createElement("div");
          this.submit.innerText = "Submit";
          this.submit.style.backgroundColor = "#aaaaaa";
          this.submit.style.width = "75px";
          this.submit.style.cursor = "pointer";
          this.submit.style.margin = "auto";
          this.submit.style.marginRight = ".25rem";
          this.submit.style.padding = ".25rem";
          this.submit.style.borderRadius = ".25rem";
          this.submit.addEventListener("click", function () {
            meatballHistoryItem.setEditable(!meatballHistoryItem.getEditable());
          });

          this.buttonGroup = document.createElement("div");
          this.buttonGroup.style.width = meatballHistoryItemContainerWidth;
          this.buttonGroup.style.textAlign = "right";
          this.buttonGroup.style.margin = "0px";
          this.buttonGroup.style.padding = "0px";
          this.buttonGroup.style.display = "flex";
          this.buttonGroup.style.alignContent = "flex-start";
          this.buttonGroup.style.justifyContent = "space-around";

          this.date = document.createElement("div");
          this.date.contentEditable = false;
          this.date.style.width = "calc(500px - 2.75rem)";
          this.date.style.padding = ".25rem";
          this.date.style.margin = "0px";
          this.date.style.textAlign = "left";
          this.date.style.fontSize = "10pt";
          this.date.style.display = "inline-block";
          this.buttonGroup.appendChild(this.date);

          this.edit = new SVGGenerator({
            color: "green",
            type: "edit",
            size: "small",
          }).wrapper;
          this.edit.style.cursor = "pointer";
          this.edit.style.flexGrow = "4";
          this.edit.style.flexShrink = "1";
          this.edit.addEventListener("click", function () {
            meatballHistoryItem.isNew = false;

            if (meatballHistoryItem.item.parentNode.isEdit) {
              meatballHistoryItem.item.parentNode.isEdit = false;
              meatballHistoryItem.setEditable(
                !meatballHistoryItem.getEditable()
              );
            }
          });
          this.buttonGroup.appendChild(this.edit);

          this.delete = new SVGGenerator({
            color: "black",
            type: "delete",
            size: "small",
          }).wrapper;
          this.delete.style.cursor = "pointer";
          this.delete.style.marginLeft = "15px";
          this.delete.style.textAlign = "left";
          this.delete.style.flexGrow = "1";
          this.delete.style.flexShrink = "1";
          this.delete.addEventListener("click", function () {
            if (meatballHistoryItem.item) {
              if (meatballHistoryItem.item.parentNode) {
                if (!meatballHistoryItem.item.parentNode.addNew) {
                  meatballHistoryItem.item.parentNode.addNew = true;
                }
                if (!meatballHistoryItem.item.parentNode.isEdit) {
                  meatballHistoryItem.item.parentNode.isEdit = true;
                }
                meatballHistoryItem.item.parentNode.removeChild(
                  meatballHistoryItem.item
                );
              }
            }
          });
          this.buttonGroup.appendChild(this.delete);

          this.item.appendChild(this.buttonGroup);

          this.comment = document.createElement("div");
          this.comment.contentEditable = false;
          this.comment.style.width = "calc(500px - 3rem)";
          this.comment.style.padding = ".25rem";
          this.comment.style.margin = "0px";
          this.comment.style.display = "inline-block";
          this.comment.style.verticalAlign = "middle";
          this.comment.style.fontSize = "14pt";

          this.item.appendChild(this.comment);
          this.item.appendChild(this.display);

          return this;
        }

        MeatballHistoryItem.prototype.setDisplay = function (
          author,
          date,
          text
        ) {
          this.author.innerText = "Author: " + author;
          this.comment.innerText = text.replace(regex, "", text);
          this.date.innerText = "Date: " + date;
          return this;
        };

        MeatballHistoryItem.prototype.setEditable = function (value) {
          if (value) {
            this.comment.style.border = "1px solid black";
            this.display.appendChild(this.submit);
          } else {
            var text = this.comment.innerText;
            text = text.replace(regex, "", text);
            this.comment.innerText = text;
            if (text.trim().length === 0) {
              return;
            }
            this.comment.style.border = "0px";
            this.display.removeChild(this.submit);

            if (!this.item.parentNode.addNew && this.isNew) {
              this.item.parentNode.addNew = true;
              this.isNew = false;
            }

            if (!this.item.parentNode.isEdit) {
              this.item.parentNode.isEdit = true;
            }
          }
          this.comment.contentEditable = value;
          return this;
        };

        MeatballHistoryItem.prototype.getEditable = function () {
          return this.comment.contentEditable === "true";
        };

        MeatballHistoryItem.prototype.setType = function (author, type) {
          if (type === "auto") {
            this.item.type = "auto";
            this.item.style.backgroundColor = "#DFDFDF";
          } else if (this.author.innerText.indexOf(author) > -1) {
            this.item.type = "editable";
            this.item.style.backgroundColor = "#F0F0F0";
          } else {
            this.item.type = "disabled";
            this.item.style.backgroundColor = "#DFDFDF";
          }
          if (this.item.type !== "editable") {
            this.delete.parentNode.removeChild(this.delete);
            this.edit.parentNode.removeChild(this.edit);
          }
        };

        MeatballHistoryItem.prototype.getType = function () {
          return this.item.type;
        };

        function SVGGenerator(props) {
          this.svg = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "svg"
          );
          this.wrapper = document.createElement("div");
          this.wrapper.style.display = "inline-block";

          this.svg.setAttribute("role", "img");
          this.svg.setAttribute("viewBox", "0 0 512 512");
          this.svg.setAttribute("alignment-baseline", "baseline");
          this.g = document.createElementNS("http://www.w3.org/2000/svg", "g");

          switch (props.size) {
            case "small":
              this.svg.setAttribute("width", ".5em");
              this.svg.setAttribute("height", ".5em");
              this.wrapper.style.width = ".5em";
              this.wrapper.style.height = ".5em";
              break;
            case "normal":
              this.svg.setAttribute("width", "1em");
              this.svg.setAttribute("height", "1em");
              this.wrapper.style.width = "1em";
              this.wrapper.style.height = "1em";
              break;
            case "large":
              this.svg.setAttribute("width", "2em");
              this.svg.setAttribute("height", "2em");
              this.wrapper.style.width = "2em";
              this.wrapper.style.height = "2em";
              break;
            default:
              this.svg.setAttribute("width", "1em");
              this.svg.setAttribute("height", "1em");
              this.wrapper.style.width = "1em";
              this.wrapper.style.height = "1em";
              break;
          }

          var path = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "path"
          );

          if (props.type !== "loading") {
            path.setAttribute("fill", props.color);
          }
          var iconPath;
          switch (props.type) {
            case "add":
              iconPath =
                "M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z";
              this.wrapper.title = "Add";
              break;

            case "delete":
              iconPath =
                "M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z";
              this.wrapper.title = "Delete";
              break;

            case "edit":
              iconPath =
                "M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z";
              this.wrapper.title = "Edit";
              break;

            case "failure":
              iconPath =
                "M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm101.8-262.2L295.6 256l62.2 62.2c4.7 4.7 4.7 12.3 0 17l-22.6 22.6c-4.7 4.7-12.3 4.7-17 0L256 295.6l-62.2 62.2c-4.7 4.7-12.3 4.7-17 0l-22.6-22.6c-4.7-4.7-4.7-12.3 0-17l62.2-62.2-62.2-62.2c-4.7-4.7-4.7-12.3 0-17l22.6-22.6c4.7-4.7 12.3-4.7 17 0l62.2 62.2 62.2-62.2c4.7-4.7 12.3-4.7 17 0l22.6 22.6c4.7 4.7 4.7 12.3 0 17z";
              this.wrapper.title = "Failure";
              break;

            case "loading":
              iconPath =
                "M 63.85,0 A 63.85,63.85 0 1 1 0,63.85 63.85,63.85 0 0 1 63.85,0 Z m 0.65,19.5 a 44,44 0 1 1 -44,44 44,44 0 0 1 44,-44 z";
              this.wrapper.title = "Loading";
              break;

            case "success":
              iconPath =
                "M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 48c110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200-110.532 0-200-89.451-200-200 0-110.532 89.451-200 200-200m140.204 130.267l-22.536-22.718c-4.667-4.705-12.265-4.736-16.97-.068L215.346 303.697l-59.792-60.277c-4.667-4.705-12.265-4.736-16.97-.069l-22.719 22.536c-4.705 4.667-4.736 12.265-.068 16.971l90.781 91.516c4.667 4.705 12.265 4.736 16.97.068l172.589-171.204c4.704-4.668 4.734-12.266.067-16.971z";
              this.wrapper.title = "Success";
              break;

            default:
              iconPath = "";
              break;
          }
          path.setAttribute("d", iconPath);
          this.g.appendChild(path);
          this.svg.appendChild(this.g);
          this.wrapper.appendChild(this.svg);
        }

        SVGGenerator.prototype.setLoadAnimation = function () {
          var linearGradient = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "linearGradient"
          );
          linearGradient.setAttribute("id", "colorFill");
          var stops = [
            {
              color: "#ffffff",
              offset: "0%",
              opacity: "0",
            },
            {
              color: "#000000",
              offset: "100%",
              opacity: "1",
            },
          ];

          stops.forEach(function (item) {
            var stop = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "stop"
            );
            stop.setAttribute("offset", item.offset);
            stop.setAttribute("stop-color", item.color);
            stop.setAttribute("fill-opacity", item.opacity);
            linearGradient.appendChild(stop);
          });
          this.g.appendChild(linearGradient);

          var animateTransform = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "animateTransform"
          );
          animateTransform.setAttribute("attributeName", "transform");
          animateTransform.setAttribute("type", "rotate");
          animateTransform.setAttribute("from", "0 64 64");
          animateTransform.setAttribute("to", "360 64 64");
          animateTransform.setAttribute("dur", "1080ms");
          animateTransform.setAttribute("repeatCount", "indefinite");
          this.g.appendChild(animateTransform);
        };

        function generateId() {
          return Math.floor(Math.random() * 1000);
        }
      })();
    </script>
  </head>
  <body>
    <div id="entry">Test</div>
  </body>
</html>
